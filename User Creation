#!/bin/bash

# Check if the script is run as root
if [ "$EUID" -ne 0 ]; then
    echo "Please run as root or use sudo."
    exit 1
fi

# Function to display usage
usage() {
    echo "Usage: $0 <username> <groupname> <directory>"
    echo "Example: $0 newuser devgroup /path/to/directory"
    exit 1
}

# Check for the correct number of arguments
if [ "$#" -ne 3 ]; then
    usage
fi

# Assign arguments to variables
USERNAME=$1
GROUPNAME=$2
DIRECTORY=$3

# Create the user
useradd -m -s /bin/bash "$USERNAME"
if [ $? -ne 0 ]; then
    echo "Failed to create user $USERNAME."
    exit 1
fi
echo "User  $USERNAME created successfully."

# Add the user to the specified group
usermod -aG "$GROUPNAME" "$USERNAME"
if [ $? -ne 0 ]; then
    echo "Failed to add user $USERNAME to group $GROUPNAME."
    exit 1
fi
echo "User  $USERNAME added to group $GROUPNAME."

# Create the directory if it doesn't exist
if [ ! -d "$DIRECTORY" ]; then
    mkdir -p "$DIRECTORY"
    echo "Directory $DIRECTORY created."
fi

# Set ownership and permissions
chown "$USERNAME:$GROUPNAME" "$DIRECTORY"
chmod 770 "$DIRECTORY"
if [ $? -ne 0 ]; then
    echo "Failed to set permissions for $DIRECTORY."
    exit 1
fi
echo "Ownership and permissions set for $DIRECTORY."

echo "User  creation and permission assignment completed successfully."
