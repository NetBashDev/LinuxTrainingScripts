#!/bin/bash

# Comprobar si se ejecuta como root
if [ "$(id -u)" -ne 0 ]; then
    echo "Este script debe ejecutarse como root o con sudo."
    exit 1
fi

# Pedir al usuario el nombre del nuevo usuario
read -p "Ingrese el nombre del nuevo usuario: " USUARIO

# Verificar si el usuario ya existe
if id "$USUARIO" &>/dev/null; then
    echo "El usuario $USUARIO ya existe. Saliendo..."
    exit 1
fi

# Pedir al usuario información adicional
read -p "Ingrese el shell predeterminado (por defecto: /bin/bash): " SHELL
SHELL=${SHELL:-/bin/bash}

read -p "Ingrese el nombre del grupo primario (por defecto: usuarios): " GRUPO
GRUPO=${GRUPO:-usuarios}

# Crear el usuario con las opciones especificadas
sudo useradd -m -s "$SHELL" -g "$GRUPO" "$USUARIO"

# Configurar una contraseña inicial
echo "Estableciendo una contraseña inicial para $USUARIO..."
sudo passwd "$USUARIO"

# Forzar el cambio de contraseña al primer inicio
sudo chage -d 0 "$USUARIO"

echo "Usuario $USUARIO creado exitosamente con las siguientes configuraciones:"
echo "  - Directorio home: /home/$USUARIO"
echo "  - Shell: $SHELL"
echo "  - Grupo: $GRUPO"
echo "  - Cambio de contraseña al primer inicio: Activado"

